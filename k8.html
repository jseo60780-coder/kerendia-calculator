<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>ì¼€ë Œë””ì•„ ê¸‰ì—¬ ì ìš© í™•ì¸</title>

  <style>
    :root{
      /* âœ… ë°°ê²½ ì—°í•˜ê²Œ(ìš”ì²­ #7) */
      --bg1: rgba(200,16,46,0.05);
      --bg2: rgba(155,15,36,0.04);

      --text:#1f2937;
      --muted:#6b7280;
      --line:#e5e7eb;

      --brand:#C8102E;
      --brand2:#9B0F24;

      --shadow: 0 18px 60px rgba(17,24,39,.10);
      --radius: 22px;
      --radius2: 16px;
      --focus: 0 0 0 4px rgba(200,16,46,.14);

      --font: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, "Noto Sans KR", "Apple SD Gothic Neo", Arial, sans-serif;
    }

    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family:var(--font);
      color:var(--text);
      min-height:100vh;
      padding: 12px 16px 40px;

      /* âœ… ë°°ê²½ ì•½í•˜ê²Œ ìì—°ìŠ¤ëŸ½ê²Œ(ìš”ì²­ #7) */
      background:
        radial-gradient(circle at 18% 10%, var(--bg1), transparent 52%),
        radial-gradient(circle at 88% 18%, var(--bg2), transparent 58%),
        linear-gradient(180deg,#ffffff 0%, #fff7f8 40%, #fdeff1 75%, #f9d6dc 100%);
    }

    .wrap{max-width:1120px;margin:0 auto;}
    .topbar{display:flex;align-items:center;justify-content:space-between;margin: 10px 0 10px;gap:12px;}
    .brand{display:flex;align-items:center;gap:14px;}
    .logo-img{height:70px;width:auto;display:block;}
    .title h1{margin:0;font-size:24px;letter-spacing:-.02em}
    .title p{margin:6px 0 0;color:var(--muted);font-size:13px}

    .pill{
      font-size:12px;color:#7f1d1d;background:rgba(200,16,46,.08);
      padding:8px 10px;border-radius:999px;border:1px solid rgba(200,16,46,.14);
      white-space:nowrap; cursor:pointer; user-select:none;
    }

    /* Stepper */
    .sticky-stepper{
      position: sticky; top: 0; z-index: 50;
      margin: 6px 0 14px; padding: 10px;
      border-radius: 999px;
      border: 1px solid rgba(229,231,235,.9);
      background: rgba(255,255,255,.86);
      backdrop-filter: blur(10px);
      box-shadow: 0 12px 30px rgba(17,24,39,.07);
    }
    .steps{display:flex;align-items:center;gap:14px;justify-content:center}
    .step{
      display:flex;align-items:center;gap:10px;color:var(--muted);font-size:13px;
      padding: 6px 10px;border-radius: 999px;
      cursor:pointer; user-select:none;
    }
    .dot{
      width:26px;height:26px;border-radius:999px;display:grid;place-items:center;
      border:1px solid var(--line);background:#fff;font-weight:800;color:var(--muted);
    }
    .step.active{color:#111827}
    .step.active .dot{
      border-color:rgba(200,16,46,.55);
      background:rgba(200,16,46,.10);
      color:#7f1d1d;
    }
    .connector{width:56px;height:2px;background:rgba(229,231,235,.9);border-radius:999px;}
    @media (max-width: 860px){ .connector{display:none} }

    /* Layout shell */
    .shell{
      background:rgba(255,255,255,.78);
      border:1px solid rgba(255,255,255,.55);
      box-shadow:var(--shadow);
      border-radius:var(--radius);
      overflow:hidden;
      backdrop-filter: blur(10px);
    }
    .content{padding:22px;}
    .grid{display:grid;grid-template-columns: 1fr 1fr;gap:16px;}
    @media (max-width: 860px){ .grid{grid-template-columns:1fr} }

    .card{
      background:#fff;border:1px solid rgba(229,231,235,.95);
      border-radius:var(--radius2);padding:18px;
      box-shadow: 0 10px 28px rgba(17,24,39,.06);
    }

    label{display:block;font-size:12px;color:#374151;margin:10px 0 6px; font-weight:700;}
    input,select,textarea{
      width:100%;
      padding:11px 12px;
      border:1px solid var(--line);
      border-radius:12px;
      outline:none;
      background:#fff;
      font-size:14px;
    }
    input:focus,select:focus,textarea:focus{
      box-shadow:var(--focus);
      border-color:rgba(200,16,46,.45)
    }

    .btn{
      border:1px solid rgba(229,231,235,.95);
      background:#fff;
      color:#111827;
      border-radius:14px;
      padding:11px 14px;
      font-weight:800;
      cursor:pointer;
      display:inline-flex;
      align-items:center;
      justify-content:center;
      gap:8px;
      transition: 0.2s;
    }
    .btn.primary{
      background:linear-gradient(135deg,var(--brand),var(--brand2));
      color:#fff;border:none;
    }
    .btn.primary:disabled{opacity:.4;cursor:not-allowed;}
    .btn:hover:not(:disabled){transform: translateY(-1px);}

    .muted{color:var(--muted)}

    /* âœ… Step 0 Hero : ë†’ì´ 80% ìˆ˜ì¤€ìœ¼ë¡œ ì¶•ì†Œ(ìš”ì²­ #6) */
    .hero-grid{
      display:grid;
      grid-template-columns: 1.05fr .95fr;
      min-height: 340px;  /* â†“ ê¸°ì¡´ë³´ë‹¤ ì§§ê²Œ */
      border-radius: 26px;
      overflow:hidden;
      border:1px solid rgba(229,231,235,.9);
      background: rgba(255,255,255,.72);
      box-shadow: 0 18px 55px rgba(17,24,39,.08);
    }
    @media (max-width: 920px){
      .hero-grid{grid-template-columns:1fr; min-height:auto;}
    }

    .hero-left{
      padding: 18px;
      display:flex;
      align-items:center;
      justify-content:center;
      background: linear-gradient(180deg, rgba(255,255,255,.55), rgba(255,255,255,.20));
    }

    /* ì¢Œì¸¡ í¬ìŠ¤í„° ì¹´ë“œ */
    .poster-card{
      width: min(360px, 92%);
      background:#fff;
      border-radius: 22px;
      padding: 18px 18px 14px;
      border:1px solid rgba(229,231,235,.9);
      box-shadow: 0 16px 42px rgba(17,24,39,.08);
      display:flex;
      flex-direction:column;
      align-items:center;
      gap:12px;
    }

    /* ì´ë¯¸ì§€ ì˜ì—­: ì„¸ë¡œ ë¹„ìœ¨ ê³ ì •ìœ¼ë¡œ â€˜ì˜† í° ì—¬ë°±â€™ ë¬¸ì œ ì¤„ì´ê¸° */
    .poster-img{
      width:100%;
      aspect-ratio: 3 / 4;         /* âœ… ì„¸ë¡œ ì¹´ë“œ ë¹„ìœ¨ ê³ ì • */
      border-radius: 18px;
      border: 1px solid rgba(229,231,235,.85);
      overflow:hidden;
      background:#f6f7fb;
      display:flex;
      align-items:center;
      justify-content:center;
    }
    .poster-img img{
      width:100%;
      height:100%;
      object-fit: cover;            /* âœ… ì—¬ë°± ì¤„ì´ê³  ê½‰ ì°¨ê²Œ */
      object-position: center;
      display:block;
    }

    /* âœ… í•˜ë‹¨ ë¬¸êµ¬(ìš”ì²­ ë°˜ì˜): 
       "2í˜• ë‹¹ë‡¨ë³‘ ë™ë°˜ ë§Œì„± ì‹ ì¥ì¹˜ë£ŒëŠ”" + "with ì¼€ë Œë””ì•„"(with íšŒìƒ‰ / ì¼€ë Œë””ì•„ ë¡œê³ ì»¬ëŸ¬) */
    .poster-caption{
      text-align:center;
      line-height:1.25;
      padding: 2px 4px 0;
    }
    .poster-caption .line1{
      font-size: 13px;
      color:#6b7280;
      font-weight:600;
    }
    .poster-caption .line2{
      margin-top:6px;
      font-size: 18px;
      font-weight:900;
      letter-spacing:-.02em;
    }
    .poster-caption .with{
      color:#9ca3af; /* íšŒìƒ‰ */
      font-weight:900;
    }
    .poster-caption .kr{
      color: var(--brand); /* ë¡œê³ ì»¬ëŸ¬ */
      font-weight:900;
    }

    .hero-right{
      padding: 26px 26px;
      display:flex;
      flex-direction:column;
      justify-content:center;

      /* ì˜¤ë¥¸ìª½ ì˜ì—­ ì€ì€í•œ í•‘í¬ ê·¸ë¼ë°ì´ì…˜ ìœ ì§€ */
      background:
        radial-gradient(circle at 30% 10%, rgba(200,16,46,.06), transparent 55%),
        linear-gradient(180deg, rgba(255,255,255,.55), rgba(253,229,232,.35) 55%, rgba(246,185,194,.22) 100%);
    }

    .hero-right h2{margin:0 0 6px;font-size:22px;letter-spacing:-.02em}
    .hero-right p{margin:0 0 14px;color:var(--muted);font-size:13px;line-height:1.55}

    textarea{
      min-height:150px;
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      font-size: 13px;
      white-space: pre-wrap;
    }

    .badge{display:inline-flex;padding:6px 12px;border-radius:999px;font-size:12px;font-weight:800;margin-top:8px;align-items:center;gap:8px;}
    .badge.good{background:#ecfdf5;color:#065f46;border:1px solid #10b981;}
    .badge.bad{background:#fef2f2;color:#991b1b;border:1px solid #ef4444;}

    #toast{
      position:fixed;bottom:20px;left:50%;transform:translateX(-50%);
      background:#111827;color:#fff;padding:10px 14px;border-radius:10px;
      opacity:0;transition:0.25s;z-index:9999;font-size:13px;
      box-shadow: 0 14px 40px rgba(17,24,39,.25);
    }
    #toast.show{opacity:1;}

    /* âœ… Modal (ì£¼ì˜ì‚¬í•­) */
    .modal-backdrop{
      position:fixed; inset:0;
      background: rgba(17,24,39,.45);
      display:none;
      align-items:center;
      justify-content:center;
      z-index:10000;
      padding:18px;
    }
    .modal{
      width:min(980px, 100%);
      background:#fff;
      border-radius:18px;
      box-shadow: 0 30px 80px rgba(0,0,0,.25);
      overflow:hidden;
      border:1px solid rgba(229,231,235,.9);
    }
    .modal-head{
      display:flex;align-items:center;justify-content:space-between;
      padding:14px 16px;
      border-bottom:1px solid rgba(229,231,235,.9);
      background: #fafafa;
    }
    .modal-head .ttl{font-weight:900}
    .modal-body{
      max-height: 62vh;
      overflow:auto;
      padding:16px;
      line-height:1.6;
      color:#111827;
      font-size:14px;
    }
    .modal-foot{
      padding:12px 16px;
      border-top:1px solid rgba(229,231,235,.9);
      display:flex;justify-content:flex-end;gap:10px;
      background:#fff;
    }

    /* âœ… Step2 ë²„íŠ¼ ê°€ìš´ë° ì •ë ¬(ìš”ì²­ #4) */
    .actions-center{
      display:flex;
      justify-content:center;
      gap:12px;
      flex-wrap:wrap;
      margin-top:14px;
    }
    .actions-center .btn{
      min-width: 180px;
    }

    .bottom-left-actions{
      display:flex;
      justify-content:center;
      gap:10px;
      margin-top:12px;
      flex-wrap:wrap;
    }

    /* âœ… Print: ìš”ì•½ë¬¸ ì•ˆ ì˜ë¦¬ê²Œ(ìš”ì²­ #2, #3) */
    @media print{
      body{background:#fff !important; padding:0 !important;}
      .sticky-stepper, .topbar, .pill, .btn, #toast, .modal-backdrop{display:none !important;}
      .wrap{max-width:100% !important;}
      .shell{box-shadow:none !important; border:none !important; border-radius:0 !important;}
      .content{padding:0 !important;}

      /* ì¶œë ¥ì— í•„ìš”í•œ ì˜ì—­ë§Œ ë³´ì´ê²Œ */
      .print-only{display:block !important;}
      .no-print{display:none !important;}

      /* textareaê°€ í˜ì´ì§€ì—ì„œ ì˜ë¦¬ì§€ ì•Šë„ë¡ */
      textarea{
        height:auto !important;
        min-height:0 !important;
        overflow:visible !important;
        border:none !important;
        padding:0 !important;
        resize:none !important;
        white-space: pre-wrap !important;
      }
    }
    .print-only{display:none;}
  </style>
</head>

<body>
  <div class="wrap">
    <div class="topbar">
      <div class="brand">
        <img src="kerendia-logo-transparent.png" alt="Kerendia" class="logo-img">
        <div class="title">
          <h1>ì¼€ë Œë””ì•„ ê¸‰ì—¬ ì ìš© í™•ì¸</h1>
          <p>CKD-EPI 2021 Equation ê¸°ë°˜ eGFR ê³„ì‚° Â· ê¸‰ì—¬ ê¸°ì¤€ ìš”ì•½</p>
        </div>
      </div>
      <div class="pill" id="refBtn" title="ì˜ë£Œì§„ ì°¸ê³ ìš© (ì˜ˆì‹œ)">ì˜ë£Œì§„ ì°¸ê³ ìš©</div>
    </div>

    <div class="sticky-stepper">
      <div class="steps">
        <div class="step active" id="step0Chip" data-step="0"><span class="dot">0</span> ì‹œì‘</div>
        <div class="connector"></div>
        <div class="step" id="step1Chip" data-step="1"><span class="dot">1</span> ì¶”ê°€ ì…ë ¥</div>
        <div class="connector"></div>
        <div class="step" id="step2Chip" data-step="2"><span class="dot">2</span> ê²°ê³¼</div>
      </div>
    </div>

    <div class="shell">
      <div class="content">

        <!-- STEP 0 -->
        <div id="step0">
          <div class="hero-grid">

            <div class="hero-left">
              <div class="poster-card">
                <div class="poster-img">
                  <img src="with-kerendia-hero-pink.png" alt="with ì¼€ë Œë””ì•„">
                </div>

                <!-- âœ… í•˜ë‹¨ ë¬¸êµ¬ ë³€ê²½ ë°˜ì˜ -->
                <div class="poster-caption">
                  <div class="line1">2í˜• ë‹¹ë‡¨ë³‘ ë™ë°˜ ë§Œì„± ì‹ ì¥ì¹˜ë£ŒëŠ”</div>
                  <div class="line2"><span class="with">with</span> <span class="kr">ì¼€ë Œë””ì•„</span></div>
                </div>
              </div>
            </div>

            <div class="hero-right">
              <h2>ê¸°ë³¸ ì •ë³´ ì…ë ¥</h2>
              <p>ì„±ë³„ê³¼ ë‚˜ì´ë¥¼ ì…ë ¥í•˜ë©´ ì‹œì‘í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>

              <label>ì„±ë³„</label>
              <select id="gender0">
                <option value="">ì„ íƒí•˜ì„¸ìš”</option>
                <option value="male">ë‚¨ì„±</option>
                <option value="female">ì—¬ì„±</option>
              </select>

              <label>ë‚˜ì´</label>
              <input type="number" id="age0" placeholder="ì˜ˆ: 62" inputmode="numeric">

              <button class="btn primary" id="goExtraBtn" type="button" disabled style="margin-top:14px">
                ê¸‰ì—¬ëŒ€ìƒ í™•ì¸í•˜ê¸°
              </button>
              <p id="startHint" class="muted" style="font-size:12px; margin-top:10px">
                ì„±ë³„ê³¼ ë‚˜ì´ë¥¼ ëª¨ë‘ ì…ë ¥í•´ ì£¼ì„¸ìš”.
              </p>
            </div>
          </div>
        </div>

        <!-- STEP 1 -->
        <div id="step1" style="display:none;">
          <div class="grid">

            <div class="card">
              <h3 style="margin:0 0 8px">ê¸°ë³¸ ì •ë³´</h3>
              <div style="display:grid; grid-template-columns:1fr 1fr; gap:10px">
                <div><label>ì„±ë³„</label><input id="genderFixed" readonly></div>
                <div><label>ë‚˜ì´</label><input id="ageFixed" readonly></div>
              </div>

              <div style="display:flex; gap:10px; margin-top:12px; flex-wrap:wrap;">
                <!-- âœ… Step1ì—ì„œ Step0ë¡œ ëŒì•„ê°€ ìˆ˜ì • ê°€ëŠ¥(ìš”ì²­) -->
                <button class="btn" id="editBasicBtn" type="button">ê¸°ë³¸ì •ë³´ ìˆ˜ì •</button>
                <button class="btn" id="backToStartBtn" type="button">ì´ì „ìœ¼ë¡œ</button>
              </div>

              <hr style="margin:18px 0; border:0; border-top:1px solid #eee">

              <h3 style="margin:0 0 6px">ê²€ì‚¬ ìˆ˜ì¹˜</h3>
              <label>í˜ˆì²­ í¬ë ˆì•„í‹°ë‹Œ (mg/dL)</label>
              <input id="creatinine" type="number" step="0.1" placeholder="ì˜ˆ: 1.2" inputmode="decimal">
              <label>ì¹¼ë¥¨ (mmol/L)</label>
              <input id="potassium" type="number" step="0.1" placeholder="ì˜ˆ: 4.5" inputmode="decimal">
            </div>

            <div class="card">
              <h3 style="margin:0 0 6px">ë‹¨ë°±ë‡¨ ë° ë™ë°˜ ì§ˆí™˜</h3>

              <label>ê²€ì‚¬ ë°©ë²•</label>
              <select id="proteinTest">
                <option value="dipstick">Dipstick (ìš” ì‹œí—˜ì§€ë´‰)</option>
                <option value="uacr">uACR (ìš”ì•Œë¶€ë¯¼/í¬ë ˆì•„í‹°ë‹Œë¹„)</option>
              </select>

              <div id="dipstickWrap">
                <label>Dipstick ê²°ê³¼</label>
                <select id="dipstick">
                  <option value="">ì„ íƒí•˜ì„¸ìš”</option>
                  <option value="negative">ìŒì„± (-)</option>
                  <option value="1plus">1+</option>
                  <option value="2plus">2+</option>
                  <option value="3plus">3+</option>
                </select>
              </div>

              <div id="uacrWrap" style="display:none">
                <label>uACR (mg/g)</label>
                <input id="uacr" type="number" placeholder="ì˜ˆ: 350" inputmode="decimal">
              </div>

              <label>ì œ2í˜• ë‹¹ë‡¨ë³‘ ì—¬ë¶€</label>
              <select id="diabetes">
                <option value="">ì„ íƒí•˜ì„¸ìš”</option>
                <option value="yes">ì˜ˆ</option>
                <option value="no">ì•„ë‹ˆì˜¤</option>
              </select>

              <label>í‘œì¤€ìš”ë²•(ACE/ARB) 4ì£¼ ì´ìƒ íˆ¬ì—¬</label>
              <select id="aceArb">
                <option value="">ì„ íƒí•˜ì„¸ìš”</option>
                <option value="yes">ì˜ˆ</option>
                <option value="no">ì•„ë‹ˆì˜¤</option>
              </select>

              <button class="btn primary" id="goResultBtn" type="button" disabled style="margin-top:14px; width:100%">
                ê²°ê³¼ í™•ì¸í•˜ê¸°
              </button>
              <p class="muted" style="font-size:12px;margin:10px 0 0">
                ëª¨ë“  í•­ëª©ì„ ì…ë ¥í•˜ë©´ ê²°ê³¼ í™•ì¸ì´ ê°€ëŠ¥í•©ë‹ˆë‹¤.
              </p>
            </div>

          </div>
        </div>

        <!-- STEP 2 -->
        <div id="step2" style="display:none;">
          <div class="card">
            <h2 id="resultTitle" style="margin:0">íŒì • ê²°ê³¼</h2>
            <div id="resultBadge" class="badge" style="margin-top:10px">ê³„ì‚° ì¤‘...</div>

            <div class="grid" style="margin-top:16px">
              <div style="background:#f9fafb; padding:15px; border-radius:12px; border:1px solid rgba(229,231,235,.9)">
                <div style="font-size:12px; color:#666">ê³„ì‚°ëœ eGFR</div>
                <div id="egfrView" style="font-size:24px; font-weight:900; color:var(--brand); margin-top:4px">-</div>
              </div>
              <div style="background:#f9fafb; padding:15px; border-radius:12px; border:1px solid rgba(229,231,235,.9)">
                <div style="font-size:12px; color:#666">ì°¸ê³  ìƒë³‘ì½”ë“œ</div>
                <div id="codeView" style="font-size:24px; font-weight:900; color:#111827; margin-top:4px">-</div>
              </div>
            </div>

            <div style="margin-top:16px">
              <label>ì‹¬ì‚¬ê¸°ì¤€ ìš”ì•½ë¬¸</label>
              <textarea id="summaryText" readonly></textarea>
              <div class="muted" style="font-size:12px;margin-top:6px">
                â€» ì¶œë ¥ ì‹œì—ëŠ” ë³¸ ê²°ê³¼/ìš”ì•½ë¬¸ ì¤‘ì‹¬ìœ¼ë¡œ ì¶œë ¥ë©ë‹ˆë‹¤.
              </div>
            </div>

            <!-- âœ… (ìš”ì²­ #1,#2,#4) ì¶œë ¥í•˜ê¸° ë²„íŠ¼ ì¶”ê°€ + ê°€ìš´ë° ì •ë ¬ -->
            <div class="actions-center">
              <button class="btn" id="copyBtn" type="button">ë‚´ìš© ë³µì‚¬</button>
              <button class="btn" id="printBtn" type="button">ì¶œë ¥ í•˜ê¸°</button>
              <button class="btn" id="noticeBtn" type="button">í™˜ì ë³µìš© ì£¼ì˜ì‚¬í•­</button>
            </div>

            <!-- âœ… (ìš”ì²­ #4) ìˆ˜ì •/ìƒˆë¡œì‹œì‘ ë²„íŠ¼ë„ ê°€ìš´ë° ì •ë ¬ -->
            <div class="bottom-left-actions">
              <button class="btn" id="editBtn" type="button">ìˆ˜ì •í•˜ê¸°</button>
              <button class="btn primary" id="restartBtn" type="button">ìƒˆë¡œ ì‹œì‘</button>
            </div>
          </div>

          <!-- âœ… print ì „ìš© ì˜ì—­(ìš”ì•½ë¬¸ ì•ˆ ì˜ë¦¬ê²Œ) -->
          <div class="print-only" id="printArea">
            <div style="padding:18px 0 0">
              <h2 style="margin:0 0 8px">íŒì • ê²°ê³¼</h2>
              <div style="margin:0 0 10px; font-weight:800" id="printBadgeText"></div>

              <div style="display:flex; gap:16px; flex-wrap:wrap; margin-bottom:12px">
                <div style="min-width:240px">
                  <div style="font-size:12px;color:#666">ê³„ì‚°ëœ eGFR</div>
                  <div style="font-size:22px;font-weight:900;color:var(--brand)" id="printEgfr"></div>
                </div>
                <div style="min-width:240px">
                  <div style="font-size:12px;color:#666">ì°¸ê³  ìƒë³‘ì½”ë“œ</div>
                  <div style="font-size:22px;font-weight:900" id="printCode"></div>
                </div>
              </div>

              <div style="font-size:12px;color:#666;margin:12px 0 6px;font-weight:800">ì‹¬ì‚¬ê¸°ì¤€ ìš”ì•½ë¬¸</div>
              <div id="printSummary" style="white-space:pre-wrap; font-size:13px; line-height:1.55;"></div>
            </div>
          </div>
        </div>

      </div>
    </div>
  </div>

  <div id="toast">ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤.</div>

  <!-- âœ… ì£¼ì˜ì‚¬í•­ ëª¨ë‹¬ -->
  <div class="modal-backdrop" id="noticeModal">
    <div class="modal" role="dialog" aria-modal="true" aria-labelledby="noticeTitle">
      <div class="modal-head">
        <div class="ttl" id="noticeTitle">í™˜ì ë³µìš© ì£¼ì˜ì‚¬í•­ (PDF ì¶œë ¥ ê°€ëŠ¥)</div>
        <button class="btn" id="closeNoticeBtn" type="button">ë‹«ê¸°</button>
      </div>
      <div class="modal-body" id="noticeBody">
        <div style="font-weight:900; margin-bottom:8px;">í™˜ì ë³µìš© ì£¼ì˜ì‚¬í•­</div>
        <ul>
          <li>ì¼€ë Œë””ì•„(Finerenone)ëŠ” ì‹ ì¥ ë³´í˜¸ ë° ì‹¬í˜ˆê´€ ì§ˆí™˜ ì˜ˆë°©ì„ ìœ„í•œ ì•½ì œë¡œ, 2í˜• ë‹¹ë‡¨ë³‘ê³¼ ë§Œì„±ì‹ ì¥ë³‘(CKD) í™˜ìì—ì„œ ì‚¬ìš©ë©ë‹ˆë‹¤.</li>
          <li>ë³µìš© ì¤‘ ê³ ì¹¼ë¥¨í˜ˆì¦ì˜ ìœ„í—˜ì´ ìˆìœ¼ë¯€ë¡œ ì •ê¸°ì ì¸ í˜ˆì•¡ê²€ì‚¬ê°€ í•„ìš”í•©ë‹ˆë‹¤.</li>
          <li><b>ê³ ì¹¼ë¥¨í˜ˆì¦ ì¦ìƒ</b>: ê·¼ìœ¡ ì•½í™”, í”¼ë¡œê°, ë¬´ê¸°ë ¥, ì‹¬ì¥ì´ ë‘ê·¼ê±°ë¦¬ê±°ë‚˜ ëŠë ¤ì§€ëŠ” ëŠë‚Œ(ë¶€ì •ë§¥). ì´ëŸ¬í•œ ì¦ìƒì´ ë‚˜íƒ€ë‚˜ë©´ ì¦‰ì‹œ ì˜ë£Œì§„ì—ê²Œ ì•Œë¦¬ì‹­ì‹œì˜¤.</li>
          <li>ê³ í˜ˆì••ì•½(RAASì–µì œì œ)ê³¼ ë³‘ìš© ì‹œ ì „í•´ì§ˆ ì´ìƒì„ ëª¨ë‹ˆí„°ë§í•´ì•¼ í•©ë‹ˆë‹¤.</li>
          <li>ì´ìƒ ì¦ìƒ ì‹œ ì¦‰ì‹œ ì˜ë£Œì§„ì— ìƒë‹´í•˜ì„¸ìš”.</li>
          <li>ì˜ì‚¬ ì§€ì‹œ ì—†ì´ ë³µìš©ì„ ì¤‘ë‹¨í•˜ê±°ë‚˜ ì¦ëŸ‰í•˜ì§€ ë§ˆì„¸ìš”.</li>
        </ul>

        <div style="margin:14px 0 8px; font-weight:900;">âœ“ CKD í™˜ìëŠ” ì •ê¸°ì ì¸ í˜ˆì•¡ê²€ì‚¬ë¡œ í˜ˆì¤‘ ì¹¼ë¥¨ ë†ë„ë¥¼ í™•ì¸í•˜ê³ , ì¹¼ë¥¨ ì„­ì·¨ ì¡°ì ˆì´ í•„ìš”í•©ë‹ˆë‹¤.</div>

        <div style="margin:10px 0 6px; font-weight:900;">ğŸ½ ì¹¼ë¥¨ ì„­ì·¨ë¥¼ ì¤„ì´ëŠ” ë°©ë²•:</div>
        <ol>
          <li>ì•¼ì±„ëŠ” ë“ëŠ” ë¬¼ì— ë°ì¹˜ê¸° (ì±„ì†Œ ë¬´ê²Œì˜ 4~5ë°° ì´ìƒ ë¬¼ ì‚¬ìš©)</li>
          <li>ì–‡ê²Œ ì¬ í›„ ì°¬ë¬¼ì— 2ì‹œê°„ ë‹´ê°”ë‹¤ê°€ ë¬¼ì„ ë²„ë¦¬ê³  ì¡°ë¦¬</li>
          <li>ì±„ì†Œ ê»ì§ˆê³¼ ì¤„ê¸° ì œê±° í›„ ì„­ì·¨</li>
        </ol>

        <div style="margin:10px 0 6px; font-weight:900;">âš ï¸ ì¹¼ë¥¨ì´ ë§ì€ ì‹í’ˆ ì£¼ì˜:</div>
        <ul>
          <li>ê°ì, ê³ êµ¬ë§ˆ, í† ë§ˆí† , ë°”ë‚˜ë‚˜, í‚¤ìœ„, ë©œë¡ </li>
          <li>ì‹œê¸ˆì¹˜, ë¯¸ì—­, ë‹¤ì‹œë§ˆ, ì½©, ê²¬ê³¼ë¥˜</li>
          <li>ì´ˆì½œë¦¿, ì»¤í”¼, ë‘ìœ , ì£¼ìŠ¤, ì¸ìŠ¤í„´íŠ¸êµ­, í™ì‚¼ì ¤ë¦¬ ë“±</li>
        </ul>

        <div style="margin:10px 0 6px; font-weight:900;">ğŸ’§ ìˆ˜ë¶„ ì„­ì·¨</div>
        <div>ìˆ˜ë¶„ ì„­ì·¨ëŠ” ì‹ ì¥ ìƒíƒœì— ë”°ë¼ ì˜ì‚¬ì™€ ìƒë‹´í•˜ì—¬ ê²°ì •í•˜ì„¸ìš”.</div>

        <div class="muted" style="margin-top:12px; font-size:12px;">
          (ì¶œì²˜: CKD in T2D Awareness Symposium, Kerendia & ì¢…ê·¼ë‹¹)
        </div>
      </div>
      <div class="modal-foot">
        <button class="btn primary" id="noticePrintBtn" type="button">PDF ì¶œë ¥</button>
      </div>
    </div>
  </div>

  <script>
    const $ = (id) => document.getElementById(id);

    const state = {
      gender: "",
      age: null
    };

    function toast(msg="ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.") {
      const t = $("toast");
      t.textContent = msg;
      t.classList.add("show");
      setTimeout(()=>t.classList.remove("show"), 1400);
    }

    /* -----------------------
       STEP ì´ë™ / Stepper í´ë¦­
    ------------------------ */
    function goStep(idx) {
      $("step0").style.display = idx === 0 ? "block" : "none";
      $("step1").style.display = idx === 1 ? "block" : "none";
      $("step2").style.display = idx === 2 ? "block" : "none";

      $("step0Chip").classList.toggle("active", idx === 0);
      $("step1Chip").classList.toggle("active", idx === 1);
      $("step2Chip").classList.toggle("active", idx === 2);

      window.scrollTo({top:0, behavior:"smooth"});
    }

    function canGoToStep(step) {
      if(step === 0) return true;
      if(step === 1) {
        return !!(state.gender && state.age);
      }
      if(step === 2) {
        // step2ëŠ” ê²°ê³¼ê°€ ìˆì–´ì•¼(ìš”ì•½ë¬¸ ìƒì„±) ì´ë™ ê°€ëŠ¥
        return !!($("summaryText").value && $("summaryText").value.trim().length > 0);
      }
      return false;
    }

    function handleStepperClick(targetStep) {
      const cur = $("step2").style.display === "block" ? 2 : ($("step1").style.display === "block" ? 1 : 0);

      // ë’¤ë¡œ ê°€ëŠ” ê±´ í•­ìƒ OK
      if(targetStep < cur) { goStep(targetStep); return; }

      // ì•ìœ¼ë¡œ ê°€ëŠ” ê±´ ê²€ì¦
      if(!canGoToStep(targetStep)){
        toast("í•´ë‹¹ ë‹¨ê³„ë¡œ ì´ë™í•˜ë ¤ë©´ ì´ì „ ì…ë ¥ì„ ì™„ë£Œí•´ ì£¼ì„¸ìš”.");
        return;
      }
      goStep(targetStep);
    }

    ["step0Chip","step1Chip","step2Chip"].forEach(id=>{
      $(id).addEventListener("click", ()=>{
        handleStepperClick(parseInt($(id).dataset.step,10));
      });
    });

    /* -----------------------
       STEP 0: ì…ë ¥ ê°ì§€
    ------------------------ */
    function updateStartUI() {
      const g = $("gender0").value;
      const a = $("age0").value;
      const ok = (g !== "" && a !== "");
      $("goExtraBtn").disabled = !ok;
      $("startHint").textContent = ok ? "ì¤€ë¹„ë˜ì—ˆìŠµë‹ˆë‹¤. ë²„íŠ¼ì„ ëˆŒëŸ¬ì£¼ì„¸ìš”." : "ì„±ë³„ê³¼ ë‚˜ì´ë¥¼ ëª¨ë‘ ì…ë ¥í•´ ì£¼ì„¸ìš”.";
    }

    $("gender0").addEventListener("change", updateStartUI);
    $("age0").addEventListener("input", updateStartUI);

    $("goExtraBtn").addEventListener("click", ()=>{
      // Step1ë¡œ ì´ë™
      state.gender = $("gender0").value;
      state.age = parseInt($("age0").value, 10);

      $("genderFixed").value = state.gender === "male" ? "ë‚¨ì„±" : "ì—¬ì„±";
      $("ageFixed").value = state.age + "ì„¸";

      goStep(1);
      updateExtraUI();
    });

    /* -----------------------
       STEP 1: ë‹¨ë°±ë‡¨ ì…ë ¥ ì „í™˜ & ê²€ì¦
    ------------------------ */
    function toggleProteinInput() {
      const isDip = $("proteinTest").value === "dipstick";
      $("dipstickWrap").style.display = isDip ? "block" : "none";
      $("uacrWrap").style.display = isDip ? "none" : "block";
      updateExtraUI();
    }
    $("proteinTest").addEventListener("change", toggleProteinInput);

    function updateExtraUI() {
      const scr = $("creatinine").value;
      const k = $("potassium").value;
      const db = $("diabetes").value;
      const ace = $("aceArb").value;

      let protOk = false;
      if ($("proteinTest").value === "dipstick") {
        protOk = $("dipstick").value !== "";
      } else {
        protOk = $("uacr").value !== "";
      }

      const ok = (scr && k && db && ace && protOk);
      $("goResultBtn").disabled = !ok;
    }

    ["creatinine","potassium","diabetes","aceArb","dipstick","uacr"].forEach(id=>{
      const el = $(id);
      el.addEventListener(el.tagName === "SELECT" ? "change" : "input", updateExtraUI);
    });

    // Step1 "ì´ì „ìœ¼ë¡œ" / "ê¸°ë³¸ì •ë³´ ìˆ˜ì •"
    $("backToStartBtn").addEventListener("click", ()=>goStep(0));
    $("editBasicBtn").addEventListener("click", ()=>{
      // ê°’ ìœ ì§€í•œ ì±„ Step0ë¡œ ëŒì•„ê°€ ìˆ˜ì •
      $("gender0").value = state.gender || "";
      $("age0").value = state.age ?? "";
      updateStartUI();
      goStep(0);
    });

    /* -----------------------
       eGFR ê³„ì‚° (CKD-EPI 2021)
    ------------------------ */
    function calcEGFR(gender, age, scr) {
      const kappa = (gender === "female") ? 0.7 : 0.9;
      const alpha = (gender === "female") ? -0.241 : -0.302;
      const genderMod = (gender === "female") ? 1.012 : 1.0;

      const minScr = Math.min(scr / kappa, 1);
      const maxScr = Math.max(scr / kappa, 1);

      const egfr = 142 * Math.pow(minScr, alpha) * Math.pow(maxScr, -1.200) * Math.pow(0.9938, age) * genderMod;
      return Math.round(egfr);
    }

    /* -----------------------
       STEP 2: ê²°ê³¼ ìƒì„±
    ------------------------ */
    function calculateAndShow() {
      const scr = parseFloat($("creatinine").value);
      const k = parseFloat($("potassium").value);

      const dbYes = $("diabetes").value === "yes";
      const aceYes = $("aceArb").value === "yes";

      const egfr = calcEGFR(state.gender, state.age, scr);

      // ë‹¨ë°±ë‡¨ í…ìŠ¤íŠ¸
      let protText = "";
      if ($("proteinTest").value === "dipstick") {
        protText = "Dipstick " + $("dipstick").value;
      } else {
        protText = "uACR " + $("uacr").value + " mg/g";
      }

      // ê°„ë‹¨ ê¸‰ì—¬ ë¡œì§(ì˜ˆì‹œ)
      const isEligible = (dbYes && aceYes && egfr >= 25 && k <= 4.8);

      $("egfrView").textContent = egfr + " mL/min";
      $("codeView").textContent = (egfr < 60 ? "N18.3" : "N18.2");

      const badge = $("resultBadge");
      if(isEligible) {
        badge.textContent = "ê¸‰ì—¬ ì¸ì • ê¸°ì¤€ ì¶©ì¡±";
        badge.className = "badge good";
      } else {
        badge.textContent = "ê¸‰ì—¬ ë¶ˆì¶©ì¡± / í™•ì¸ í•„ìš”";
        badge.className = "badge bad";
      }

      const gTxt = (state.gender === "male" ? "ë‚¨ì„±" : "ì—¬ì„±");
      const summary =
`[${isEligible ? "ê¸‰ì—¬ ì ì •" : "ê¸‰ì—¬ ì£¼ì˜"}]
ê¸°ë³¸ì •ë³´: ${gTxt}, ${state.age}ì„¸
ê²€ì‚¬: Cr ${scr} mg/dL, K ${k} mmol/L, eGFR ${egfr} mL/min
ë™ë°˜: T2D ${dbYes ? "ì˜ˆ" : "ì•„ë‹ˆì˜¤"}, ACE/ARB 4ì£¼ ì´ìƒ ${aceYes ? "ì˜ˆ" : "ì•„ë‹ˆì˜¤"}
ë‹¨ë°±ë‡¨: ${protText}

íŒì •: eGFR ê¸°ì¤€ ${egfr>=25 ? "ì¶©ì¡±(â‰¥25)" : "ë¯¸ë‹¬(<25)"}, K ê¸°ì¤€ ${k<=4.8 ? "ì¶©ì¡±(â‰¤4.8)" : "ì´ˆê³¼(>4.8)"},
T2D/ACE-ARB ì¡°ê±´ ${dbYes && aceYes ? "ì¶©ì¡±" : "ë¯¸ì¶©ì¡±"}.
`;
      $("summaryText").value = summary;

      // print ì „ìš© ì±„ìš°ê¸°
      $("printBadgeText").textContent = badge.textContent;
      $("printEgfr").textContent = $("egfrView").textContent;
      $("printCode").textContent = $("codeView").textContent;
      $("printSummary").textContent = summary;

      goStep(2);
    }

    $("goResultBtn").addEventListener("click", calculateAndShow);

    /* -----------------------
       Step2 ì•¡ì…˜: ë³µì‚¬ / ì¶œë ¥ / ì£¼ì˜ì‚¬í•­
    ------------------------ */
    $("copyBtn").addEventListener("click", async ()=>{
      try{
        await navigator.clipboard.writeText($("summaryText").value);
        toast("ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤.");
      }catch(e){
        // fallback
        $("summaryText").select();
        document.execCommand("copy");
        toast("ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤.");
      }
    });

    // âœ… ì¶œë ¥í•˜ê¸°: ê²°ê³¼/ìš”ì•½ë¬¸ë§Œ ì¶œë ¥ë˜ë„ë¡ print-only ì˜ì—­ ì‚¬ìš©
    $("printBtn").addEventListener("click", ()=>{
      window.print();
    });

    // ì£¼ì˜ì‚¬í•­ ëª¨ë‹¬
    function openNotice(){
      $("noticeModal").style.display = "flex";
    }
    function closeNotice(){
      $("noticeModal").style.display = "none";
    }
    $("noticeBtn").addEventListener("click", openNotice);
    $("closeNoticeBtn").addEventListener("click", closeNotice);
    $("noticeModal").addEventListener("click", (e)=>{
      if(e.target === $("noticeModal")) closeNotice();
    });

    // ì£¼ì˜ì‚¬í•­ PDF ì¶œë ¥(ë¸Œë¼ìš°ì € print)
    $("noticePrintBtn").addEventListener("click", ()=>{
      // ëª¨ë‹¬ë§Œ ë”°ë¡œ ì¸ì‡„í•˜ê¸´ ë³µì¡í•´ì„œ: í˜„ì¬ëŠ” ëª¨ë‹¬ ë‹«ê³  ì•ˆë‚´ í›„ ì¶œë ¥
      closeNotice();
      toast("ì¸ì‡„ ì°½ì´ ì—´ë¦½ë‹ˆë‹¤.");
      setTimeout(()=>window.print(), 250);
    });

    // ìˆ˜ì •/ìƒˆë¡œ ì‹œì‘
    $("editBtn").addEventListener("click", ()=>{
      // Step1ë¡œ ê°€ì„œ ìˆ˜ì • (ì…ë ¥ê°’ì€ ê·¸ëŒ€ë¡œ ìœ ì§€)
      goStep(1);
    });
    $("restartBtn").addEventListener("click", ()=>{
      location.reload();
    });

    // ì°¸ê³ ìš© pill
    $("refBtn").addEventListener("click", ()=>{
      toast("ì°¸ê³ ìš© UIì…ë‹ˆë‹¤.");
    });

    // ì´ˆê¸° UI
    updateStartUI();
    toggleProteinInput();
  </script>
</body>
</html>
