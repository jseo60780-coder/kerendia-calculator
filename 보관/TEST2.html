<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>케렌디아 적용 여부 판단 계산기</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f0f4ff;
      margin: 0;
      padding: 20px;
    }
    .container {
      max-width: 900px;
      margin: auto;
      background: #fff;
      padding: 24px;
      border-radius: 12px;
      box-shadow: 0 4px 20px rgba(0,0,0,0.1);
    }
    h1 { margin-bottom: 20px; }
    h2 { margin-top: 30px; }
    label { display: block; margin-top: 12px; font-weight: bold; }
    input, select, button {
      width: 100%;
      padding: 8px;
      margin-top: 6px;
      font-size: 14px;
    }
    button {
      margin-top: 20px;
      background: #4f46e5;
      color: white;
      border: none;
      border-radius: 6px;
      cursor: pointer;
    }
    button:disabled {
      background: #ccc;
      cursor: not-allowed;
    }
    .result {
      margin-top: 30px;
      padding: 20px;
      border-radius: 10px;
    }
    .ok { background: #ecfdf5; color: #065f46; }
    .no { background: #fef2f2; color: #991b1b; }
    ul { margin-top: 10px; }
  </style>
</head>
<body>

<div class="container">
  <h1>케렌디아 적용 여부 판단 계산기</h1>

  <h2>기본 정보</h2>
  <label>성별</label>
  <select id="gender">
    <option value="">선택하세요</option>
    <option value="male">남성</option>
    <option value="female">여성</option>
  </select>

  <label>나이</label>
  <input type="number" id="age" placeholder="45-85세">

  <h2>검사 수치</h2>
  <label>혈청 크레아티닌 (mg/dL)</label>
  <input type="number" step="0.1" id="creatinine">

  <label>칼륨 (mmol/L)</label>
  <input type="number" step="0.1" id="potassium">

  <h2>단백뇨 검사 (Dipstick)</h2>
  <label>결과</label>
  <select id="dipstick">
    <option value="">선택하세요</option>
    <option value="negative">음성</option>
    <option value="trace">±</option>
    <option value="1plus">1+</option>
    <option value="2plus">2+</option>
    <option value="3plus">3+</option>
  </select>

  <h2>추가 조건</h2>
  <label>제2형 당뇨병</label>
  <select id="diabetes">
    <option value="">선택하세요</option>
    <option value="yes">예</option>
    <option value="no">아니오</option>
  </select>

  <label>ACE억제제 또는 ARB 4주 이상</label>
  <select id="aceArb">
    <option value="">선택하세요</option>
    <option value="yes">예</option>
    <option value="no">아니오</option>
  </select>

  <label>만성 심부전 (NYHA II~IV)</label>
  <select id="heartFailure">
    <option value="">선택하세요</option>
    <option value="yes">예</option>
    <option value="no">아니오</option>
  </select>

  <button onclick="calculate()">판정 결과 확인</button>

  <div id="result"></div>
</div>

<script>
function calculateEGFR(gender, age, creatinine) {
  const K = gender === 'male' ? 0.9 : 0.7;
  const alpha = gender === 'male' ? -0.302 : -0.241;
  const min = Math.min(creatinine / K, 1);
  const max = Math.max(creatinine / K, 1);
  let eGFR = 142 * Math.pow(min, alpha) * Math.pow(max, -1.2) * Math.pow(0.9938, age);
  if (gender === 'female') eGFR *= 1.012;
  return Math.round(eGFR);
}

function calculate() {
  const gender = genderEl.value;
  const age = parseInt(ageEl.value);
  const creatinine = parseFloat(creatinineEl.value);
  const potassium = parseFloat(potassiumEl.value);
  const dipstick = dipstickEl.value;

  let eligible = true;
  let reasons = [];

  if (diabetesEl.value !== 'yes') {
    eligible = false;
    reasons.push('제2형 당뇨병 환자가 아닙니다');
  }

  if (aceArbEl.value !== 'yes') {
    eligible = false;
    reasons.push('ACE억제제 또는 ARB를 4주 이상 투여하지 않았습니다');
  }

  const eGFR = calculateEGFR(gender, age, creatinine);

  if (eGFR < 25 || eGFR >= 75) {
    eligible = false;
    reasons.push('eGFR 기준(25 이상 75 미만)을 충족하지 않습니다');
  }

  if (dipstick === '' || dipstick === 'negative' || dipstick === 'trace') {
    eligible = false;
    reasons.push('요 시험지봉 검사 결과가 1+ 미만입니다');
  }

  if (potassium > 4.8) {
    eligible = false;
    reasons.push('칼륨 수치가 4.8 mmol/L를 초과합니다');
  }

  if (heartFailureEl.value === 'yes') {
    eligible = false;
    reasons.push('만성 심부전 환자는 제외됩니다');
  }

  let html = `<div class="result ${eligible ? 'ok' : 'no'}">
    <h2>${eligible ? '케렌디아 적용 가능' : '케렌디아 적용 불가'}</h2>
    <p><strong>eGFR:</strong> ${eGFR} mL/min/1.73㎡</p>`;

  if (!eligible) {
    html += '<ul>' + reasons.map(r => `<li>${r}</li>`).join('') + '</ul>';
  }

  html += '</div>';
  resultEl.innerHTML = html;
}

const genderEl = document.getElementById('gender');
const ageEl = document.getElementById('age');
const creatinineEl = document.getElementById('creatinine');
const potassiumEl = document.getElementById('potassium');
const dipstickEl = document.getElementById('dipstick');
const diabetesEl = document.getElementById('diabetes');
const aceArbEl = document.getElementById('aceArb');
const heartFailureEl = document.getElementById('heartFailure');
const resultEl = document.getElementById('result');
</script>

</body>
</html>
