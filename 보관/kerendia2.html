<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>ì¼€ë Œë””ì•„ ì ìš© ì—¬ë¶€ íŒë‹¨ ê³„ì‚°ê¸°</title>
  <style>
    :root{
      --bg1:#fff3e6;
      --bg2:#ffe8cc;
      --card:#ffffff;
      --text:#1f2937;
      --muted:#6b7280;
      --line:#e5e7eb;
      --brand:#f59e0b;
      --brand2:#fb923c;
      --good:#16a34a;
      --bad:#dc2626;
      --shadow: 0 18px 60px rgba(17,24,39,.12);
      --radius: 22px;
      --radius2: 16px;
      --focus: 0 0 0 4px rgba(245,158,11,.18);
      --font: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, "Noto Sans KR", "Apple SD Gothic Neo", Arial, sans-serif;
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      font-family:var(--font);
      color:var(--text);
      background:
        radial-gradient(circle at 20% 15%, rgba(245,158,11,.22), transparent 42%),
        radial-gradient(circle at 85% 35%, rgba(251,146,60,.18), transparent 45%),
        linear-gradient(180deg, var(--bg1), var(--bg2));
      min-height:100vh;
      padding:28px 16px 40px;
    }
    .wrap{max-width:1060px;margin:0 auto;}
    .topbar{
      display:flex;align-items:center;justify-content:space-between;
      margin:6px 0 18px;
      gap:12px;
    }
    .brand{
      display:flex;align-items:center;gap:12px;
    }
    .logo{
      width:44px;height:44px;border-radius:14px;
      background:linear-gradient(135deg,var(--brand),var(--brand2));
      box-shadow:0 12px 30px rgba(245,158,11,.22);
    }
    .title h1{margin:0;font-size:22px;letter-spacing:-.02em}
    .title p{margin:4px 0 0;color:var(--muted);font-size:13px}
    .pill{
      font-size:12px;color:#92400e;background:rgba(245,158,11,.14);
      padding:8px 10px;border-radius:999px;border:1px solid rgba(245,158,11,.22);
      white-space:nowrap;
    }

    .shell{
      background:rgba(255,255,255,.72);
      border:1px solid rgba(255,255,255,.55);
      box-shadow:var(--shadow);
      border-radius:var(--radius);
      overflow:hidden;
      backdrop-filter: blur(10px);
    }

    .stepper{
      padding:18px 18px 10px;
      display:flex;justify-content:center;
      border-bottom:1px solid rgba(229,231,235,.8);
      background:linear-gradient(180deg, rgba(255,255,255,.78), rgba(255,255,255,.62));
    }
    .steps{display:flex;align-items:center;gap:14px;flex-wrap:wrap;justify-content:center}
    .step{
      display:flex;align-items:center;gap:10px;color:var(--muted);font-size:13px;
    }
    .dot{
      width:26px;height:26px;border-radius:999px;
      display:grid;place-items:center;
      border:1px solid var(--line);
      background:#fff;
      font-weight:700;
      color:var(--muted);
    }
    .step.active{color:#111827}
    .step.active .dot{
      border-color:rgba(245,158,11,.6);
      background:rgba(245,158,11,.14);
      color:#92400e;
    }
    .connector{
      width:56px;height:2px;background:rgba(229,231,235,.9);
      border-radius:999px;
    }
    .step.active + .connector{background:linear-gradient(90deg, rgba(245,158,11,.6), rgba(251,146,60,.45));}

    .content{padding:22px;}
    .grid{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap:16px;
    }
    @media (max-width: 860px){
      .grid{grid-template-columns:1fr}
      .connector{display:none}
    }

    .card{
      background:var(--card);
      border:1px solid rgba(229,231,235,.95);
      border-radius:var(--radius2);
      padding:18px;
      box-shadow: 0 10px 28px rgba(17,24,39,.06);
    }
    .section-title{
      display:flex;align-items:center;justify-content:space-between;gap:10px;
      margin:0 0 12px;
    }
    .section-title h2{margin:0;font-size:16px;letter-spacing:-.01em}
    .section-title small{color:var(--muted)}

    label{display:block;font-size:12px;color:#374151;margin:10px 0 6px}
    input,select,textarea{
      width:100%;
      padding:11px 12px;
      border:1px solid var(--line);
      border-radius:12px;
      outline:none;
      background:#fff;
      font-size:14px;
    }
    textarea{min-height:120px;resize:vertical}
    input:focus,select:focus,textarea:focus{box-shadow:var(--focus);border-color:rgba(245,158,11,.55)}
    .row2{display:grid;grid-template-columns:1fr 1fr;gap:12px}
    .hint{margin-top:6px;font-size:12px;color:var(--muted)}
    .muted{color:var(--muted)}
    .divider{height:1px;background:rgba(229,231,235,.9);margin:12px 0}
    .actions{
      display:flex;gap:10px;flex-wrap:wrap;
      margin-top:14px;
    }
    .btn{
      border:1px solid rgba(229,231,235,.95);
      background:#fff;
      color:#111827;
      border-radius:14px;
      padding:11px 14px;
      font-weight:700;
      cursor:pointer;
      transition:.15s transform, .15s opacity, .15s background;
      display:inline-flex;align-items:center;gap:8px;
    }
    .btn:hover{transform: translateY(-1px)}
    .btn:active{transform: translateY(0)}
    .btn.primary{
      border-color:rgba(245,158,11,.55);
      background:linear-gradient(135deg,var(--brand),var(--brand2));
      color:#111827;
    }
    .btn.primary[disabled]{opacity:.55;cursor:not-allowed;transform:none}
    .btn.soft{
      background:rgba(245,158,11,.10);
      border-color:rgba(245,158,11,.25);
      color:#92400e;
    }
    .btn.danger{
      background:rgba(220,38,38,.08);
      border-color:rgba(220,38,38,.18);
      color:#991b1b;
    }

    .result-head{
      display:flex;align-items:flex-start;justify-content:space-between;gap:16px;
      margin-bottom:12px;
    }
    .badge{
      display:inline-flex;align-items:center;gap:8px;
      padding:8px 10px;border-radius:999px;
      font-size:12px;font-weight:800;
      border:1px solid rgba(229,231,235,.9);
      background:#fff;
      white-space:nowrap;
    }
    .badge.good{color:var(--good);border-color:rgba(22,163,74,.25);background:rgba(22,163,74,.08)}
    .badge.bad{color:var(--bad);border-color:rgba(220,38,38,.25);background:rgba(220,38,38,.08)}

    .kpi{
      display:grid;grid-template-columns:1fr 1fr;gap:12px;
    }
    @media (max-width: 860px){
      .kpi{grid-template-columns:1fr}
    }
    .kpi .box{
      padding:14px;border-radius:16px;border:1px solid rgba(229,231,235,.92);
      background:rgba(249,250,251,.75);
    }
    .kpi .box .k{font-size:12px;color:var(--muted)}
    .kpi .box .v{font-size:22px;font-weight:900;margin-top:6px}
    ul{margin:8px 0 0 18px}
    li{margin:4px 0}

    .toast{
      position:fixed;left:50%;bottom:18px;transform:translateX(-50%);
      background:#111827;color:#fff;
      padding:10px 12px;border-radius:12px;
      box-shadow:0 14px 40px rgba(0,0,0,.22);
      font-size:13px;
      opacity:0;pointer-events:none;
      transition:.18s opacity;
      z-index:9999;
    }
    .toast.show{opacity:1}

    /* Modal */
    .modal-backdrop{
      position:fixed;inset:0;background:rgba(17,24,39,.55);
      display:none;align-items:center;justify-content:center;
      padding:18px;z-index:9998;
    }
    .modal-backdrop.open{display:flex}
    .modal{
      width:min(920px, 100%);
      background:#fff;
      border-radius:22px;
      overflow:hidden;
      box-shadow:0 20px 70px rgba(0,0,0,.28);
      border:1px solid rgba(255,255,255,.4);
    }
    .modal header{
      padding:14px 16px;
      display:flex;align-items:center;justify-content:space-between;gap:12px;
      background:linear-gradient(180deg, rgba(255,255,255,.96), rgba(249,250,251,.95));
      border-bottom:1px solid rgba(229,231,235,.9);
    }
    .modal header strong{font-size:14px}
    .modal .body{padding:14px}
    .modal img{
      width:100%;
      height:auto;
      border-radius:14px;
      border:1px solid rgba(229,231,235,.95);
      background:#f9fafb;
    }

    /* Print (PDF) */
    @media print{
      body{background:#fff;padding:0}
      .topbar,.stepper,.no-print,.modal-backdrop,.toast{display:none !important}
      .shell{box-shadow:none;border:none}
      .content{padding:0}
      .card{box-shadow:none}
      .print-area{break-inside:avoid}
    }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="topbar">
      <div class="brand">
        <div class="logo" aria-hidden="true"></div>
        <div class="title">
          <h1>ì¼€ë Œë””ì•„ ì ìš© ì—¬ë¶€ íŒë‹¨ ê³„ì‚°ê¸°</h1>
          <p>CKD-EPI Creatinine Equation (2021) ê¸°ë°˜ eGFR ê³„ì‚° Â· ê¸‰ì—¬ ê¸°ì¤€ ìš”ì•½</p>
        </div>
      </div>
      <div class="pill">1íŒŒì¼ HTML Â· ë©”ëª¨ì¥ ì €ì¥ìš©</div>
    </div>

    <div class="shell">
      <div class="stepper">
        <div class="steps">
          <div class="step active" id="step1Chip"><span class="dot">1</span> ì…ë ¥</div>
          <div class="connector"></div>
          <div class="step" id="step2Chip"><span class="dot">2</span> ê²°ê³¼</div>
        </div>
      </div>

      <div class="content">
        <!-- STEP 1 -->
        <div id="step1">
          <div class="grid">
            <div class="card">
              <div class="section-title">
                <h2>ê¸°ë³¸ ì •ë³´</h2>
                <small class="muted">í•„ìˆ˜ ì…ë ¥</small>
              </div>

              <label>ì„±ë³„</label>
              <select id="gender">
                <option value="">ì„ íƒí•˜ì„¸ìš”</option>
                <option value="male">ë‚¨ì„±</option>
                <option value="female">ì—¬ì„±</option>
              </select>

              <label>ë‚˜ì´</label>
              <input id="age" type="number" min="18" max="120" placeholder="ì˜ˆ: 62" />

              <div class="divider"></div>

              <div class="section-title">
                <h2>ê²€ì‚¬ ìˆ˜ì¹˜</h2>
                <small class="muted">Scr, K</small>
              </div>

              <div class="row2">
                <div>
                  <label>í˜ˆì²­ í¬ë ˆì•„í‹°ë‹Œ (mg/dL)</label>
                  <input id="creatinine" type="number" step="0.1" placeholder="ì˜ˆ: 1.2" />
                  <div class="hint">ê°„ì´í‘œëŠ” í˜ˆì²­ í¬ë ˆì•„í‹°ë‹Œ ê¸°ì¤€</div>
                </div>
                <div>
                  <label>ì¹¼ë¥¨ (mmol/L)</label>
                  <input id="potassium" type="number" step="0.1" placeholder="ì˜ˆ: 4.5" />
                  <div class="hint">ì‹œì‘ ê¶Œì¥: â‰¤ 4.8</div>
                </div>
              </div>
            </div>

            <div class="card">
              <div class="section-title">
                <h2>ë‹¨ë°±ë‡¨/ì•Œë¶€ë¯¼ë‡¨</h2>
                <small class="muted">ë‘˜ ì¤‘ í•˜ë‚˜</small>
              </div>

              <label>ê²€ì‚¬ ë°©ë²•</label>
              <select id="proteinTest">
                <option value="dipstick">ìš” ì‹œí—˜ì§€ë´‰ ê²€ì‚¬ (Dipstick)</option>
                <option value="uacr">uACR (ìš”ì•Œë¶€ë¯¼/í¬ë ˆì•„í‹°ë‹Œë¹„)</option>
              </select>

              <div id="dipstickWrap">
                <label>Dipstick ê²°ê³¼</label>
                <select id="dipstick">
                  <option value="">ì„ íƒí•˜ì„¸ìš”</option>
                  <option value="negative">ìŒì„± (-)</option>
                  <option value="trace">ì•½ì–‘ì„± (Â±)</option>
                  <option value="1plus">1+</option>
                  <option value="2plus">2+</option>
                  <option value="3plus">3+</option>
                </select>
              </div>

              <div id="uacrWrap" style="display:none;">
                <label>uACR (mg/g)</label>
                <input id="uacr" type="number" step="1" placeholder="ì˜ˆ: 350" />
              </div>

              <div class="divider"></div>

              <div class="section-title">
                <h2>ì¶”ê°€ ì¡°ê±´</h2>
                <small class="muted">ê¸‰ì—¬ ê¸°ì¤€</small>
              </div>

              <label>ì œ2í˜• ë‹¹ë‡¨ë³‘ í™˜ìì…ë‹ˆê¹Œ?</label>
              <select id="diabetes">
                <option value="">ì„ íƒí•˜ì„¸ìš”</option>
                <option value="yes">ì˜ˆ</option>
                <option value="no">ì•„ë‹ˆì˜¤</option>
              </select>

              <label>ACEì–µì œì œ ë˜ëŠ” ARBë¥¼ ìµœëŒ€í—ˆìš© ìš©ëŸ‰ìœ¼ë¡œ 4ì£¼ ì´ìƒ íˆ¬ì—¬ ì¤‘ì…ë‹ˆê¹Œ?</label>
              <select id="aceArb">
                <option value="">ì„ íƒí•˜ì„¸ìš”</option>
                <option value="yes">ì˜ˆ</option>
                <option value="no">ì•„ë‹ˆì˜¤</option>
              </select>

              <label>ë§Œì„± ì‹¬ë¶€ì „(NYHA class II~IV) í™˜ìì…ë‹ˆê¹Œ?</label>
              <select id="heartFailure">
                <option value="">ì„ íƒí•˜ì„¸ìš”</option>
                <option value="yes">ì˜ˆ</option>
                <option value="no">ì•„ë‹ˆì˜¤</option>
              </select>

              <div class="actions no-print">
                <button class="btn primary" id="goResultBtn" disabled>ê¸‰ì—¬ ê²°ê³¼ í™•ì¸í•˜ê¸°</button>
                <button class="btn" id="resetBtn">ì´ˆê¸°í™”</button>
              </div>

              <div class="hint" id="validHint">ëª¨ë“  í•„ìˆ˜ê°’ì„ ì…ë ¥í•˜ë©´ ë²„íŠ¼ì´ í™œì„±í™”ë©ë‹ˆë‹¤.</div>
            </div>
          </div>
        </div>

        <!-- STEP 2 -->
        <div id="step2" style="display:none;">
          <div class="grid">
            <div class="card print-area">
              <div class="result-head">
                <div>
                  <div class="section-title" style="margin-bottom:6px">
                    <h2>íŒì • ê²°ê³¼</h2>
                    <small class="muted">ìš”ì•½ë¬¸ ìƒì„±</small>
                  </div>
                  <div id="resultBadge" class="badge">â€”</div>
                </div>
                <div class="actions no-print" style="margin:0">
                  <button class="btn soft" id="openReviewBtn">ì¹˜ë£Œ í›„ê¸° ë³´ê¸°</button>
                  <button class="btn" id="backBtn">ì…ë ¥ìœ¼ë¡œ</button>
                </div>
              </div>

              <div class="kpi">
                <div class="box">
                  <div class="k">ê³„ì‚°ëœ eGFR</div>
                  <div class="v" id="egfrView">â€”</div>
                  <div class="hint muted">mL/min/1.73ã¡</div>
                </div>
                <div class="box">
                  <div class="k">ìƒë³‘ì½”ë“œ(ì°¸ê³  í‘œê¸°)</div>
                  <div class="v" id="codeView">â€”</div>
                  <div class="hint muted">ê¸°ê´€/ì§„ë‹¨ì— ë”°ë¼ ë‹¬ë¼ì§ˆ ìˆ˜ ìˆìŒ</div>
                </div>
              </div>

              <div class="divider"></div>

              <div id="reasonWrap" style="display:none;">
                <div class="badge bad" style="margin-bottom:8px;">ì ìš© ë¶ˆê°€ ì‚¬ìœ </div>
                <ul id="reasons"></ul>
              </div>

              <div id="okWrap" style="display:none;">
                <div class="badge good" style="margin-bottom:8px;">ì¶©ì¡± ê¸°ì¤€</div>
                <ul id="oks"></ul>
              </div>
            </div>

            <div class="card print-area">
              <div class="section-title">
                <h2>ê²°ê³¼ ìš”ì•½ë¬¸</h2>
                <small class="muted">ë³µì‚¬/ì¶œë ¥ ê°€ëŠ¥</small>
              </div>

              <label>ìš”ì•½ë¬¸</label>
              <textarea id="summary" readonly></textarea>

              <div class="actions no-print">
                <button class="btn primary" id="copyBtn">ìš”ì•½ë¬¸ ë³µì‚¬</button>
                <button class="btn" id="printBtn">ìš”ì•½ë¬¸ PDF í”„ë¦°íŠ¸</button>
                <button class="btn danger" id="newBtn">ìƒˆë¡œìš´ ê²€ì‚¬</button>
              </div>

              <div class="divider"></div>

              <div>
                <div class="section-title" style="margin-bottom:6px">
                  <h2>í™˜ì ë³µìš© ì£¼ì˜ì‚¬í•­</h2>
                  <small class="muted">í•˜ë‹¨ ê³ ì • ë¬¸êµ¬</small>
                </div>
                <div style="font-size:13px;line-height:1.55;color:#111827">
                  <strong>í™˜ì ë³µìš© ì£¼ì˜ì‚¬í•­:</strong><br/>
                  - ì¼€ë Œë””ì•„(Finerenone)ëŠ” ì‹ ì¥ ë³´í˜¸ ë° ì‹¬í˜ˆê´€ ì§ˆí™˜ ì˜ˆë°©ì„ ìœ„í•œ ì•½ì œë¡œ,
                  2í˜• ë‹¹ë‡¨ë³‘ê³¼ ë§Œì„±ì‹ ì¥ë³‘(CKD) í™˜ìì—ì„œ ì‚¬ìš©ë©ë‹ˆë‹¤.<br/><br/>

                  - ë³µìš© ì¤‘ ê³ ì¹¼ë¥¨í˜ˆì¦ì˜ ìœ„í—˜ì´ ìˆìœ¼ë¯€ë¡œ ì •ê¸°ì ì¸ í˜ˆì•¡ê²€ì‚¬ê°€ í•„ìš”í•©ë‹ˆë‹¤.<br/>
                  - ê³ ì¹¼ë¥¨í˜ˆì¦ ì¦ìƒ: ê·¼ìœ¡ ì•½í™”, í”¼ë¡œê°, ë¬´ê¸°ë ¥, ì‹¬ì¥ì´ ë‘ê·¼ê±°ë¦¬ê±°ë‚˜ ëŠë ¤ì§€ëŠ” ëŠë‚Œ(ë¶€ì •ë§¥)<br/>
                  &nbsp;&nbsp;ì´ëŸ¬í•œ ì¦ìƒì´ ë‚˜íƒ€ë‚˜ë©´ ì¦‰ì‹œ ì˜ë£Œì§„ì—ê²Œ ì•Œë¦¬ì‹­ì‹œì˜¤.<br/>
                  - ê³ í˜ˆì••ì•½(RAASì–µì œì œ)ê³¼ ë³‘ìš© ì‹œ ì „í•´ì§ˆ ì´ìƒì„ ëª¨ë‹ˆí„°ë§í•´ì•¼ í•©ë‹ˆë‹¤.<br/>
                  - ì´ìƒ ì¦ìƒ ì‹œ ì¦‰ì‹œ ì˜ë£Œì§„ì— ìƒë‹´í•˜ì„¸ìš”.<br/>
                  - ì˜ì‚¬ ì§€ì‹œ ì—†ì´ ë³µìš©ì„ ì¤‘ë‹¨í•˜ê±°ë‚˜ ì¦ëŸ‰í•˜ì§€ ë§ˆì„¸ìš”.<br/><br/>

                  âœ” CKD í™˜ìëŠ” ì •ê¸°ì ì¸ í˜ˆì•¡ê²€ì‚¬ë¡œ í˜ˆì¤‘ ì¹¼ë¥¨ ë†ë„ë¥¼ í™•ì¸í•˜ê³ , ì¹¼ë¥¨ ì„­ì·¨ ì¡°ì ˆì´ í•„ìš”í•©ë‹ˆë‹¤.<br/><br/>

                  ğŸ½ ì¹¼ë¥¨ ì„­ì·¨ë¥¼ ì¤„ì´ëŠ” ë°©ë²•:<br/>
                  &nbsp;1. ì•¼ì±„ëŠ” ë“ëŠ” ë¬¼ì— ë°ì¹˜ê¸° (ì±„ì†Œ ë¬´ê²Œì˜ 4~5ë°° ì´ìƒ ë¬¼ ì‚¬ìš©)<br/>
                  &nbsp;2. ì–‡ê²Œ ì¬ í›„ ì°¬ë¬¼ì— 2ì‹œê°„ ë‹´ê°”ë‹¤ê°€ ë¬¼ì„ ë²„ë¦¬ê³  ì¡°ë¦¬<br/>
                  &nbsp;3. ì±„ì†Œ ê»ì§ˆê³¼ ì¤„ê¸° ì œê±° í›„ ì„­ì·¨<br/><br/>

                  âš ï¸ ì¹¼ë¥¨ì´ ë§ì€ ì‹í’ˆ ì£¼ì˜:<br/>
                  - ê°ì, ê³ êµ¬ë§ˆ, í† ë§ˆí† , ë°”ë‚˜ë‚˜, í‚¤ìœ„, ë©œë¡ <br/>
                  - ì‹œê¸ˆì¹˜, ë¯¸ì—­, ë‹¤ì‹œë§ˆ, ì½©, ê²¬ê³¼ë¥˜<br/>
                  - ì´ˆì½œë¦¿, ì»¤í”¼, ë‘ìœ , ì£¼ìŠ¤, ì¸ìŠ¤í„´íŠ¸êµ­, í™ì‚¼ì ¤ë¦¬ ë“±<br/><br/>

                  ğŸ’§ ìˆ˜ë¶„ ì„­ì·¨ëŠ” ì‹ ì¥ ìƒíƒœì— ë”°ë¼ ì˜ì‚¬ì™€ ìƒë‹´í•˜ì—¬ ê²°ì •í•˜ì„¸ìš”.<br/>
                  (ì¶œì²˜: CKD in T2D Awareness Symposium, Kerendia &amp; ì¢…ê·¼ë‹¹)
                </div>
              </div>

              <div class="hint muted" style="margin-top:10px">
                * ë³¸ ë„êµ¬ëŠ” ì°¸ê³ ìš©ì´ë©°, ìµœì¢… ì²˜ë°©/ê¸‰ì—¬ íŒë‹¨ì€ ì˜ë£Œì§„ì´ ì„ìƒì •ë³´ ë° í—ˆê°€ì‚¬í•­/ì‹¬ì‚¬ê¸°ì¤€ì— ë”°ë¼ ê²°ì •í•©ë‹ˆë‹¤.
              </div>
            </div>
          </div>
        </div>

      </div>
    </div>
  </div>

  <!-- Modal -->
  <div class="modal-backdrop" id="modalBackdrop" role="dialog" aria-modal="true" aria-label="ì¹˜ë£Œ í›„ê¸°">
    <div class="modal">
      <header>
        <strong>ì¹˜ë£Œ í›„ê¸°</strong>
        <button class="btn" id="closeModalBtn" style="padding:8px 10px">ë‹«ê¸°</button>
      </header>
      <div class="body">
        <!-- ê°™ì€ í´ë”ì— reviewë¥¼ ë‘ë©´ ìë™ í‘œì‹œë©ë‹ˆë‹¤. -->
        <img id="reviewImg" src="review.png" alt="ì¹˜ë£Œ í›„ê¸° ì´ë¯¸ì§€ (review)" />
        <div class="hint muted" style="margin-top:10px">
          ì´ë¯¸ì§€ê°€ ì•ˆ ë³´ì´ë©´ ê°™ì€ í´ë”ì— <b>review</b> íŒŒì¼ì„ ë„£ê±°ë‚˜, ì´ HTMLì˜ <code>review</code> íŒŒì¼ëª…ì„ ì‹¤ì œ íŒŒì¼ëª…ìœ¼ë¡œ ë°”ê¿”ì£¼ì„¸ìš”.
        </div>
      </div>
    </div>
  </div>

  <div class="toast" id="toast">ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤.</div>

  <script>
    // ---------- Helpers ----------
    const $ = (id)=>document.getElementById(id);
    function toast(msg){
      const t = $("toast");
      t.textContent = msg;
      t.classList.add("show");
      setTimeout(()=>t.classList.remove("show"), 1400);
    }
    function toNum(v){ const n = parseFloat(v); return Number.isFinite(n)? n : NaN; }
    function toInt(v){ const n = parseInt(v,10); return Number.isFinite(n)? n : NaN; }

    // CKD-EPI Creatinine Equation (2021)
    function calcEGFR(gender, age, creatinine){
      const K = gender === "male" ? 0.9 : 0.7;
      const alpha = gender === "male" ? -0.302 : -0.241;
      const scr = toNum(creatinine);
      const ageNum = toInt(age);

      const min = Math.min(scr / K, 1);
      const max = Math.max(scr / K, 1);

      let egfr = 142 * Math.pow(min, alpha) * Math.pow(max, -1.200) * Math.pow(0.9938, ageNum);
      if(gender === "female") egfr *= 1.012;

      return Math.round(egfr);
    }

    function diseaseCodeFromEGFR(egfr){
      if(egfr >= 60 && egfr < 75) return "N182 (ë§Œì„±ì‹ ì¥ë³‘ 2ê¸°)";
      if(egfr >= 30 && egfr < 60) return "N183 (ë§Œì„±ì‹ ì¥ë³‘ 3ê¸°)";
      if(egfr >= 25 && egfr < 30) return "N184 (ë§Œì„±ì‹ ì¥ë³‘ 4ê¸°)";
      if(egfr >= 25 && egfr < 75) return "N189 (ìƒì„¸ë¶ˆëª…ì˜ ë§Œì„±ì‹ ì¥ë³‘) [ì˜µì…˜ í‘œê¸°]";
      return "";
    }

    function formState(){
      return {
        gender: $("gender").value,
        age: $("age").value,
        creatinine: $("creatinine").value,
        potassium: $("potassium").value,
        proteinTest: $("proteinTest").value,
        dipstick: $("dipstick").value,
        uacr: $("uacr").value,
        diabetes: $("diabetes").value,
        aceArb: $("aceArb").value,
        heartFailure: $("heartFailure").value
      }
    }

    function isValid(){
      const f = formState();
      if(!f.gender || !f.age || !f.creatinine || !f.potassium || !f.diabetes || !f.aceArb || !f.heartFailure) return false;
      if(f.proteinTest === "dipstick"){
        if(!f.dipstick) return false;
      }else{
        if(!f.uacr) return false;
      }
      return true;
    }

    function updateValidUI(){
      const ok = isValid();
      $("goResultBtn").disabled = !ok;
      $("validHint").textContent = ok ? "ì¤€ë¹„ ì™„ë£Œ! 'ê¸‰ì—¬ ê²°ê³¼ í™•ì¸í•˜ê¸°'ë¥¼ ëˆŒëŸ¬ ê²°ê³¼ í™”ë©´ìœ¼ë¡œ ì´ë™í•©ë‹ˆë‹¤." : "ëª¨ë“  í•„ìˆ˜ê°’ì„ ì…ë ¥í•˜ë©´ ë²„íŠ¼ì´ í™œì„±í™”ë©ë‹ˆë‹¤.";
    }

    function buildResult(){
      const f = formState();
      const egfr = calcEGFR(f.gender, f.age, f.creatinine);

      let eligible = true;
      const reasons = [];
      const oks = [];

      // diabetes
      if(f.diabetes !== "yes"){ eligible = false; reasons.push("ì œ2í˜• ë‹¹ë‡¨ë³‘ í™˜ìê°€ ì•„ë‹™ë‹ˆë‹¤."); }
      else oks.push("ì œ2í˜• ë‹¹ë‡¨ë³‘ í™˜ì");

      // ACE/ARB
      if(f.aceArb !== "yes"){ eligible = false; reasons.push("ACEì–µì œì œ ë˜ëŠ” ARBë¥¼ ìµœëŒ€í—ˆìš© ìš©ëŸ‰ìœ¼ë¡œ 4ì£¼ ì´ìƒ íˆ¬ì—¬ ì¤‘ì´ ì•„ë‹™ë‹ˆë‹¤."); }
      else oks.push("ACEì–µì œì œ ë˜ëŠ” ARB 4ì£¼ ì´ìƒ íˆ¬ì—¬ ì¤‘");

      // eGFR window
      if(egfr < 25){ eligible = false; reasons.push(`eGFR ${egfr} (25 ë¯¸ë§Œ) â†’ íˆ¬ì—¬ ì‹œì‘ ê¶Œì¥ ì•ˆ ë¨`); }
      else if(egfr >= 75){ eligible = false; reasons.push(`eGFR ${egfr} (75 ì´ìƒ)`); }
      else oks.push("eGFR 25 ì´ìƒ 75 ë¯¸ë§Œ");

      // protein
      if(f.proteinTest === "dipstick"){
        if(!f.dipstick || f.dipstick === "negative" || f.dipstick === "trace"){
          eligible = false; reasons.push("ìš” ì‹œí—˜ì§€ë´‰ ê²€ì‚¬ ê²°ê³¼ê°€ 1+ ë¯¸ë§Œì…ë‹ˆë‹¤.");
        }else oks.push("ë‹¨ë°±ë‡¨ ê¸°ì¤€ ì¶©ì¡± (Dipstick 1+ ì´ìƒ)");
      }else{
        const u = toNum(f.uacr);
        if(!Number.isFinite(u) || u <= 300){
          eligible = false; reasons.push("uACRì´ 300 mg/g ì´í•˜ì…ë‹ˆë‹¤.");
        }else oks.push("ì•Œë¶€ë¯¼ë‡¨ ê¸°ì¤€ ì¶©ì¡± (uACR > 300)");
      }

      // potassium
      const k = toNum(f.potassium);
      if(!Number.isFinite(k)){ eligible = false; reasons.push("ì¹¼ë¥¨ ìˆ˜ì¹˜ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”."); }
      else if(k > 4.8){ eligible = false; reasons.push(`ì¹¼ë¥¨ ${k} mmol/L (4.8 ì´ˆê³¼)`); }
      else oks.push("ì¹¼ë¥¨ 4.8 mmol/L ì´í•˜");

      // HF exclusion
      if(f.heartFailure === "yes"){ eligible = false; reasons.push("ë§Œì„± ì‹¬ë¶€ì „(NYHA class II~IV)ì€ ê¸‰ì—¬ ê¸°ì¤€ì—ì„œ ì œì™¸ë©ë‹ˆë‹¤."); }
      else oks.push("ë§Œì„± ì‹¬ë¶€ì „ ì—†ìŒ");

      // Discontinue note (from criteria sheet)
      if(egfr < 15){
        eligible = false;
        reasons.push(`eGFR ${egfr} (15 ë¯¸ë§Œ) â†’ íˆ¬ì—¬ ì¤‘ë‹¨ ê¸°ì¤€ êµ¬ê°„`);
      }

      // disease code (display)
      let code = "";
      if(egfr >= 25 && egfr < 75){
        // ê¸°ë³¸ì€ stage code. í•„ìš”í•˜ë©´ N189 ì˜µì…˜ë„ í•¨ê»˜ í‘œê¸° ê°€ëŠ¥.
        const stage = diseaseCodeFromEGFR(egfr);
        if(egfr >= 60 && egfr < 75) code = "N182 (ë§Œì„±ì‹ ì¥ë³‘ 2ê¸°)";
        else if(egfr >= 30 && egfr < 60) code = "N183 (ë§Œì„±ì‹ ì¥ë³‘ 3ê¸°)";
        else if(egfr >= 25 && egfr < 30) code = "N184 (ë§Œì„±ì‹ ì¥ë³‘ 4ê¸°)";
        // ì˜µì…˜ í‘œê¸°ê°€ í•„ìš”í•œ ê²½ìš°(ê¸°ê´€ë³„), ì•„ë˜ ì£¼ì„ í•´ì œ:
        // code += " / N189(ìƒì„¸ë¶ˆëª…ì˜ ë§Œì„±ì‹ ì¥ë³‘)";
      }else{
        code = "â€”";
      }

      // summary text
      const sexKo = f.gender === "male" ? "ë‚¨" : "ì—¬";
      const proteinText = (f.proteinTest === "dipstick")
        ? `Dipstick: ${f.dipstick || "ë¯¸ì…ë ¥"}`
        : `uACR: ${f.uacr || "ë¯¸ì…ë ¥"} mg/g`;
      const dmText = f.diabetes === "yes" ? "ì˜ˆ" : "ì•„ë‹ˆì˜¤";
      const aceText = f.aceArb === "yes" ? "ì˜ˆ" : "ì•„ë‹ˆì˜¤";
      const hfText = f.heartFailure === "yes" ? "ì˜ˆ" : "ì•„ë‹ˆì˜¤";

      const header = `ì¼€ë Œë””ì•„ ê¸‰ì—¬ ì ìš© íŒë‹¨ ìš”ì•½`;
      const line1 = `- ê¸°ë³¸ì •ë³´: ì„±ë³„ ${sexKo}, ë‚˜ì´ ${f.age}ì„¸`;
      const line2 = `- ê²€ì‚¬: Scr ${f.creatinine} mg/dL, K ${f.potassium} mmol/L, ${proteinText}`;
      const line3 = `- ì¡°ê±´: ì œ2í˜• ë‹¹ë‡¨ ${dmText}, ACEi/ARB 4ì£¼ ì´ìƒ ${aceText}, ë§Œì„±ì‹¬ë¶€ì „(NYHA II~IV) ${hfText}`;
      const line4 = `- ê³„ì‚° eGFR: ${egfr} mL/min/1.73ã¡`;
      const line5 = `- ê²°ê³¼: ${eligible ? "ì¼€ë Œë””ì•„ ì ìš© ê°€ëŠ¥" : "ì¼€ë Œë””ì•„ ì ìš© ë¶ˆê°€"}`;
      const line6 = code && code !== "â€”" ? `- ìƒë³‘ì½”ë“œ(ì°¸ê³ ): ${code}` : `- ìƒë³‘ì½”ë“œ(ì°¸ê³ ): â€”`;
      const line7 = !eligible && reasons.length ? `- ì ìš© ë¶ˆê°€ ì‚¬ìœ : ${reasons.join(" / ")}` : `- ì ìš© ê¸°ì¤€ ì¶©ì¡± í•­ëª©: ${oks.join(" / ")}`;

      const summary = [header,line1,line2,line3,line4,line5,line6,line7].join("\n");

      return {eligible, egfr, code, reasons, oks, summary};
    }

    function renderResult(r){
      $("egfrView").textContent = r.egfr;
      $("codeView").textContent = r.code || "â€”";

      const badge = $("resultBadge");
      badge.className = "badge " + (r.eligible ? "good" : "bad");
      badge.textContent = r.eligible ? "âœ” ì¼€ë Œë””ì•„ ì ìš© ê°€ëŠ¥" : "âœ– ì¼€ë Œë””ì•„ ì ìš© ë¶ˆê°€";

      // reasons
      $("reasons").innerHTML = "";
      $("oks").innerHTML = "";

      if(!r.eligible && r.reasons.length){
        $("reasonWrap").style.display = "block";
        $("okWrap").style.display = "none";
        r.reasons.forEach(x=>{
          const li = document.createElement("li");
          li.textContent = x;
          $("reasons").appendChild(li);
        });
      }else{
        $("reasonWrap").style.display = "none";
        $("okWrap").style.display = "block";
        r.oks.forEach(x=>{
          const li = document.createElement("li");
          li.textContent = x;
          $("oks").appendChild(li);
        });
      }

      $("summary").value = r.summary;
    }

    function goStep(step){
      const s1 = $("step1"), s2 = $("step2");
      const c1 = $("step1Chip"), c2 = $("step2Chip");
      if(step === 1){
        s1.style.display = "block";
        s2.style.display = "none";
        c1.classList.add("active");
        c2.classList.remove("active");
        window.scrollTo({top:0, behavior:"smooth"});
      }else{
        s1.style.display = "none";
        s2.style.display = "block";
        c1.classList.remove("active");
        c2.classList.add("active");
        window.scrollTo({top:0, behavior:"smooth"});
      }
    }

    function resetAll(){
      ["gender","age","creatinine","potassium","proteinTest","dipstick","uacr","diabetes","aceArb","heartFailure"].forEach(id=>{
        const el = $(id);
        if(!el) return;
        if(el.tagName === "SELECT") el.value = (id==="proteinTest") ? "dipstick" : "";
        else el.value = "";
      });
      $("uacrWrap").style.display="none";
      $("dipstickWrap").style.display="block";
      updateValidUI();
      goStep(1);
    }

    // ---------- Events ----------
    document.addEventListener("input", updateValidUI);
    document.addEventListener("change", (e)=>{
      if(e.target && e.target.id === "proteinTest"){
        const v = e.target.value;
        $("dipstickWrap").style.display = (v==="dipstick") ? "block" : "none";
        $("uacrWrap").style.display = (v==="uacr") ? "block" : "none";
        updateValidUI();
      }
    });

    $("goResultBtn").addEventListener("click", ()=>{
      const r = buildResult();
      renderResult(r);
      goStep(2);
    });

    $("resetBtn").addEventListener("click", resetAll);
    $("backBtn").addEventListener("click", ()=>goStep(1));
    $("newBtn").addEventListener("click", resetAll);

    // Copy
    $("copyBtn").addEventListener("click", async ()=>{
      const text = $("summary").value;
      try{
        await navigator.clipboard.writeText(text);
        toast("ìš”ì•½ë¬¸ì´ ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤.");
      }catch(err){
        // fallback
        $("summary").select();
        document.execCommand("copy");
        toast("ìš”ì•½ë¬¸ì´ ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤.");
      }
    });

    // Print to PDF
    $("printBtn").addEventListener("click", ()=>{
      toast("ë¸Œë¼ìš°ì € ì¸ì‡„ ì°½ì´ ì—´ë¦½ë‹ˆë‹¤. 'PDFë¡œ ì €ì¥'ì„ ì„ íƒí•˜ì„¸ìš”.");
      window.print();
    });

    // Modal
    const backdrop = $("modalBackdrop");
    $("openReviewBtn").addEventListener("click", ()=>backdrop.classList.add("open"));
    $("closeModalBtn").addEventListener("click", ()=>backdrop.classList.remove("open"));
    backdrop.addEventListener("click", (e)=>{ if(e.target === backdrop) backdrop.classList.remove("open"); });

    // Init
    updateValidUI();
  </script>
</body>
</html>
